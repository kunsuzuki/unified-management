# 一元管理アプリ 仕様書・要件定義書

## 1. プロジェクト概要

### 1.1 背景と目的

現在、ドキュメント管理、タスク管理、メモ管理などの機能は複数のアプリに分散しており、情報の一元管理が難しい状況にある。NotionやObsidianなどの多機能アプリは存在するが、多機能すぎて重かったり、気軽に使えなかったりする課題がある。

本プロジェクトでは、ドキュメント、タスク、メモを一元管理できるシンプルで使いやすいWebアプリケーションを開発する。異なる種類のコンテンツ（ドキュメント、タスク、メモ）間の紐付けを可能にし、情報管理の効率化を図る。

### 1.2 プロジェクトの目標

- シンプルで使いやすいインターフェースの実現
- ドキュメント、タスク、メモの一元管理
- 異なるコンテンツ間の紐付け機能の提供
- 既存の複雑なアプリとの差別化

## 2. 機能要件（MVP）

### 2.1 全体機能

- ユーザー認証（サインアップ、ログイン、ログアウト）
- 複数デバイス間でのデータ同期
- 検索機能（タグ、キーワードによる横断検索）
- コンテンツ間の紐付け機能
- グローバルタグ管理（コンテンツ間で共通利用可能なタグ）

### 2.2 ドキュメント管理

- マークダウンエディタ
  - 基本的なマークダウン記法のサポート
  - コードハイライト機能
  - 画像の挿入機能
  - 標準的なキーボードショートカット対応（Ctrl+Z/⌘+Z など）
- 手動保存機能（保存ボタンによる明示的な保存）
- ドキュメントの整理（フォルダ/カテゴリ分け）

### 2.3 タスク管理

- タスクの作成、編集、削除（CRUD機能）
- 日時管理（対応日、スケジュール、納期など）
- 複数ビューの提供
  - カンバンビュー（ステータスによる分類）
  - カレンダービュー（日付による表示）
  - リストビュー
- タグによる分類と検索
- 階層構造（親タスク・子タスク）の管理

### 2.4 メモ管理

- シンプルなメモ作成インターフェース
- 短文投稿（Twitter/X風のシンプルなUI）
- ハッシュタグによる分類と検索
- メモの整理と一覧表示

## 3. 非機能要件

### 3.1 パフォーマンス

- ページ読み込み時間：2秒以内
- 編集操作のレスポンス：500ms以内
- 同時接続ユーザー数：初期段階で100ユーザー程度を想定

### 3.2 セキュリティ

- ユーザーデータの暗号化
- セキュアな認証システム
- XSS、CSRFなどの一般的な脆弱性対策

### 3.3 ユーザビリティ

- 直感的なUI/UX
- レスポンシブデザイン（PC、タブレット、スマートフォン対応）
- アクセシビリティへの配慮

### 3.4 拡張性

- 将来的な機能追加を考慮した設計
- APIの整備（将来的な外部連携のため）

## 4. 技術スタック（決定）

### 4.1 フロントエンド

- **フレームワーク**: Next.js (App Router)
- **UIライブラリ**: Tailwind CSS、shadcn/ui
- **状態管理**: 
  - サーバーコンポーネントとServer Actionsを最大限活用
  - URL状態管理: nuqs
  - クライアント状態: React Context API
- **エディタ**: 
  - マークダウン: MDXEditor（軽量でカスタマイズ可能）
  - シンタックスハイライト: Prism.js（ライトウェイト）
- **フォーム管理**: React Hook Form + Zod
- **アイコン**: lucide-react

### 4.2 バックエンド

- **サーバー**: Next.js Server Components と Server Actions
  - API Routesは使用せず、Server Actionsでサーバー処理を実装
- **データベース**: Supabase（PostgreSQL）
  - リレーショナルデータモデルに適合
  - 無料プランで十分な機能と容量
  - RLS（Row Level Security）でセキュリティ強化
- **認証**: NextAuth.js + Supabase Auth
  - ソーシャルログインとメールパスワード認証の両方をサポート

### 4.3 リアルタイム同期

- **データ同期**: Supabase Realtime
  - データ変更のリアルタイム通知
  - タスクステータス変更などの即時反映
- **データ取得**: SWR
  - キャッシュと自動再取得によるパフォーマンス最適化

### 4.4 デプロイ・ホスティング

- **フロントエンド**: Cloudflare Pages（無料プラン）
  - 商用利用も無料で可能
  - GitHub連携による自動デプロイ
  - グローバルな高速配信ネットワーク
  - 必要に応じてCloudflare Workersを活用可能
- **バックエンド**: Supabase（無料プラン）
  - データベース、認証、ストレージを統合管理
  - 商用利用も無料プランで可能

## 5. データモデル（概要）

### 5.1 User
- id: ユーザーID
- email: メールアドレス
- name: 表示名
- created_at: 作成日時
- updated_at: 更新日時

### 5.2 Tag
- id: タグID
- user_id: 作成者ID
- name: タグ名
- color: 色コード（オプション）
- is_global: グローバルタグフラグ（true/false）
- created_at: 作成日時
- updated_at: 更新日時

### 5.3 TagMapping
- id: マッピングID
- tag_id: タグID（Tagテーブル参照）
- content_type: コンテンツタイプ（Document = 1, Task = 2, Memo = 3）
- content_id: コンテンツID
- created_at: 作成日時

### 5.4 Document
- id: ドキュメントID
- user_id: 作成者ID
- title: タイトル
- content: 内容（マークダウン形式）
- created_at: 作成日時
- updated_at: 更新日時

### 5.5 Task
- id: タスクID
- user_id: 作成者ID
- title: タイトル
- description: 説明
- status: ステータス（未着手、進行中、完了など）
- due_date: 期限
- parent_id: 親タスクID（階層構造用）
- created_at: 作成日時
- updated_at: 更新日時

### 5.6 Memo
- id: メモID
- user_id: 作成者ID
- content: 内容
- created_at: 作成日時
- updated_at: 更新日時

### 5.7 Relation
- id: 関連ID
- source_type: 関連元タイプ（Document = 1, Task = 2, Memo = 3）
- source_id: 関連元ID
- target_type: 関連先タイプ（Document = 1, Task = 2, Memo = 3）
- target_id: 関連先ID
- created_at: 作成日時

## 6. リアルタイム同期要件

### 6.1 MVPで必要なリアルタイム同期

- **複数デバイス間での同期**
  - 同一ユーザーの異なるデバイスでのデータ一貫性確保

- **タスクステータス変更の即時反映**
  - ステータス変更、タグ変更などの即時反映

### 6.2 MVPでは不要なリアルタイム同期

- 複数ユーザー間のリアルタイム共同編集
- リアルタイムチャット/コメント機能
- 編集競合の高度な解決機能
- ドキュメント編集時の自動保存（将来機能として検討）

## 7. 開発アプローチ

### 7.1 段階的MVP開発

1. **第1段階**: 基本的なドキュメント管理機能
   - マークダウンエディタ
   - 保存・読み込み機能
   - 基本的なユーザー認証

2. **第2段階**: タスク管理機能の追加
   - タスクCRUD
   - カンバンビュー
   - カレンダービュー

3. **第3段階**: メモ機能の追加
   - シンプルなメモ作成
   - タグ付け機能

4. **第4段階**: コンテンツ間の紐付け機能
   - 関連付けインターフェース
   - 横断検索機能

### 7.2 開発・テストサイクル

- 各機能実装後に短期間のユーザーテスト
- フィードバックに基づく改善
- 1-2週間単位の反復開発

## 8. 将来的な拡張機能（長期展望）

- チーム機能
- チャット機能
- グループチャット
- チーム内でのタスク・ドキュメント共有
- AIによる提案やアドバイス機能
- ドキュメント自動保存機能
  - ユーザー設定で自動保存のON/OFF切り替え
  - 自動保存の間隔設定（30秒〜5分など）

## 9. 開発リソース

### 9.1 開発ツール

- Gemini CLI: 基本的な機能実装の自動化
- バージョン管理: Git/GitHub
- デプロイ: Cloudflare Pages

### 9.2 開発プロセス

1. 基本設計（Gemini CLIによる自動生成）
2. 機能実装（Gemini CLIによる自動生成）
3. UI/UXの改善（人間によるフィードバック）
4. テストとバグ修正
5. デプロイと継続的改善

---

本仕様書は、一元管理アプリの開発指針として作成されました。実際の開発過程で得られるフィードバックに基づいて適宜更新されます。
